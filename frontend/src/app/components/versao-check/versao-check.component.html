<div class="versao-check">
  <h2>üîí Controle de Concorr√™ncia</h2>
  
  <div class="tabs">
    <button mat-button (click)="abaAtiva = 'versao'" [class.active]="abaAtiva === 'versao'">Obter Vers√£o</button>
    <button mat-button (click)="abaAtiva = 'conflito'" [class.active]="abaAtiva === 'conflito'">Verificar Conflito</button>
  </div>

  <div *ngIf="abaAtiva === 'versao'" class="tab-content">
    <form [formGroup]="versaoForm" (ngSubmit)="obterVersao()">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>ID do Benef√≠cio</mat-label>
        <input matInput type="number" formControlName="beneficioId" required>
      </mat-form-field>

      <button mat-raised-button color="primary" type="submit" [disabled]="!versaoForm.valid || carregandoVersao">
        {{ carregandoVersao ? 'Obtendo...' : 'Obter Vers√£o' }}
      </button>
    </form>

    <div *ngIf="resultadoVersao" class="resultado" [class.success]="resultadoVersao.success">
      <div *ngIf="resultadoVersao.success" class="versao-info">
        <h4>Vers√£o do Benef√≠cio #{{ resultadoVersao.beneficioId }}</h4>
        <div class="versao-numero">v{{ resultadoVersao.versao }}</div>
      </div>
      <div *ngIf="!resultadoVersao.success" class="erro">
        {{ resultadoVersao.message }}
      </div>
    </div>
  </div>

  <div *ngIf="abaAtiva === 'conflito'" class="tab-content">
    <form [formGroup]="conflitoForm" (ngSubmit)="verificarConflito()">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>ID do Benef√≠cio</mat-label>
        <input matInput type="number" formControlName="beneficioId" required>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Vers√£o Atual (do Cliente)</mat-label>
        <input matInput type="number" formControlName="versao" required>
      </mat-form-field>

      <button mat-raised-button color="primary" type="submit" [disabled]="!conflitoForm.valid || carregandoConflito">
        {{ carregandoConflito ? 'Verificando...' : 'Verificar Conflito' }}
      </button>
    </form>

    <div *ngIf="resultadoConflito" class="resultado" [class.success]="!resultadoConflito.temConflito" [class.error]="resultadoConflito.temConflito">
      <div *ngIf="resultadoConflito.success">
        <h4>{{ resultadoConflito.temConflito ? '‚ùå Conflito Detectado' : '‚úÖ Sem Conflitos' }}</h4>
        <p>Vers√£o informada: v{{ resultadoConflito.versaoInformada }}</p>
        <p *ngIf="resultadoConflito.temConflito" class="warning">
          ‚ö†Ô∏è Os dados foram modificados por outro usu√°rio. Atualize antes de continuar.
        </p>
        <p *ngIf="!resultadoConflito.temConflito" class="success">
          ‚úì Vers√£o atualizada. Pode prosseguir com a opera√ß√£o.
        </p>
      </div>
      <div *ngIf="!resultadoConflito.success" class="erro">
        {{ resultadoConflito.message }}
      </div>
    </div>
  </div>
</div>